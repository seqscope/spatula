{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to spatula documentation","text":"<p>This is the documentation for the <code>spatula</code> toolkit. </p>"},{"location":"#what-is-spatula","title":"What is spatula?","text":"<p><code>spatula</code> is a collection of C++ tools that are designed to help analyze  sub-micron resolution spatial transcriptomics data such as Seq-Scope.  These tools are under active development, so they may change frequently. </p>"},{"location":"#documentation-overview","title":"Documentation Overview","text":"<p>This documentation provides the following information:</p> <ul> <li>Quickstart: A quick guide to get started with spatula.</li> <li>Install: How to install spatula.</li> <li>Tools: Documentation of individual tools implemented in spatula.</li> </ul>"},{"location":"install/","title":"Installing spatula","text":""},{"location":"install/#directory-structure","title":"Directory structure","text":"<p>Before installing <code>spatula</code>, it is recommended to install htslib and qgenlib  in the same directory you want to install <code>spatula</code> (i.e. <code>spatula</code>, <code>qgenlib</code>, and <code>htslib</code> should be siblings directories). </p> <p>To visualize the directory structure of the installation, it should look like this: </p> <pre><code>/path/to/install\n|-- htslib\n|   `-- libhts.a\n|-- qgenlib\n|   `-- lib/\n|       `--libqgen.a\n`-- spatula\n</code></pre> <p>If you need assistance in installing <code>htslib</code> and <code>qgenlib</code>, see the documentation of htslib and  qgenlib</p>"},{"location":"install/#installing-spatula_1","title":"Installing spatula","text":"<p>After installing <code>htslib</code> and <code>qgenlib</code>, you can clone the current snapshot of this repository to install as follows</p> <pre><code>## clone the current snapshot of this repository\n$ git clone https://github.com/hyunminkang/qgenlib.git\n\n## move to the qgenlib directory\n$ cd qgenlib\n\n## create a build directory\n$ mkdir build\n\n## move to the build directory\n$ cd build\n\n## run cmake to configure the build\n$ cmake ..\n</code></pre> <p>If <code>cmake</code> is not found, you need to install cmake in your system.</p>"},{"location":"install/#optional-customized-specification-of-the-library-path","title":"(Optional) Customized specification of the library path","text":"<p>In case any required libraries is missing, you may specify customized installing path by replacing \"cmake ..\" with the following options:</p> <pre><code>## If qgenlib is missing or installed in a different directory\n$ cmake -DQGEN_INCLUDE_DIRS=/qgenlib_absolute_path/include\n        -DHTS_LIBRARIES=/qgenlib_absolute_path/lib/libqgen.a ..\n\n## If htslib is missing or installed in a different directory\n$ cmake -DHTS_INCLUDE_DIRS=/htslib_absolute_path/include/  \\\n        -DHTS_LIBRARIES=/htslib_absolute_path/libhts.a ..\n\n## If bzip2 is missing or installed in a different directory\n$ cmake -DBZIP2_INCLUDE_DIRS=/bzip2_absolute_path/include/ \\\n        -DBZIP2_LIBRARIES=/bzip2_absolute_path/lib/libbz2.a ..\n\n## If lzma is missing or installed in a different directory\n$ cmake -DLZMA_INCLUDE_DIRS=/lzma_absolute_path/include/ \\\n        -DLZMA_LIBRARIES=/lzma_absolute_path/lib/liblzma.a ..\n\n## You may combine the multiples options above if needed.\n## Other missing libraries can be handled in a similar way.\n</code></pre>"},{"location":"install/#building-the-library","title":"Building the library","text":"<p>Once <code>cmake</code> is run successfully without errors, you can build the library by typing:</p> <pre><code>## Current directory: /path/to/install/spatula/build\n$ make\n</code></pre> <p>To test whether build was successful, you can run the following command:</p> <pre><code>## Current directory: /path/to/install/spatula/build\n$ ../bin/spatula --help\n</code></pre>"},{"location":"quickstart/","title":"Quickstart for spatula","text":""},{"location":"quickstart/#installing-spatula","title":"Installing spatula","text":"<p>Before installing <code>spatula</code>, you need to install htslib and  qgenlib  in the same directory you want to install <code>spatula</code> (i.e. <code>spatula</code>, <code>qgenlib</code>, and <code>htslib</code> should be siblings directories). You also need cmake installed in your system.</p> <p>After installing <code>htslib</code> and <code>qgenlib</code>, you can clone the current snapshot of this repository to install as well</p> <pre><code>$ git clone https://github.com/seqscope/spatula.git\n$ cd spatula\n$ mkdir build\n$ cd build\n$ cmake ..\n$ make\n\n## List the available tools\n$ ../bin/spatula --help\n</code></pre> <p>If you encounter any difficulties, see Install for more details.</p>"},{"location":"tools/","title":"Tools in spatula","text":"<p><code>spatula</code> is a collection of C++ tools that are designed to help analyze  sub-micron resolution spatial transcriptomics data such as Seq-Scope.  The categories of software tools provided includes:</p> <ul> <li>Tools for Analyzing Spatial Barcodes </li> <li>Tools for Analyzing Spatial Gene Expression (SGE)</li> <li>Tools for Processing FASTQ Files</li> <li>Miscellaneous Tools</li> </ul> <p>Note that the documentation contain only a subset of tools that <code>spatula</code> provides.  Other tools not documented here is either deprecated or under active development.</p>"},{"location":"tools/build_sbcds/","title":"spatula build-sbcds","text":""},{"location":"tools/build_sbcds/#summary","title":"Summary","text":"<p><code>spatula build-sbcds</code> creates a spatial barcode dictionary based from an Illumina FASTQ file. Here is a summary of the main features:</p> <ul> <li>Input: Takes a single-ended Illumina-sequenced FASTQ file containing the original read names as  input.</li> <li>Output: Produces a map of spatial barcodes (i.e. a mapping between barcode sequences and spatial coordinates), separated by each tile. It also generates a manifest file that summarizes the output for each tile. </li> </ul> <p>An example usage of the tool is as follows:</p> <pre><code>spatula build-sbcds --fq1 /path/to/input_file.R1.fastq.gz --format DraI32 \\\n                    --out /path/to/output/dir/\n</code></pre> <p>See below for a more detailed usage description.</p>"},{"location":"tools/build_sbcds/#required-options","title":"Required options","text":"<ul> <li><code>--fq</code> : The path to the (single-ended) input FASTQ file. The read name must include the spatial coordinate information. (i.e. SRA-processed read names must not be used)</li> <li><code>--format</code> : Predefined spatial barcode format. It specifies the expected patterns of spatial barcodes, and whether reverse complement is required or not. A limited number of barcode patterns, including experimental ones, are accepted. The most popular choices are:<ul> <li><code>DraI32</code> : 32-bp barcode format from the Seq-Scope paper. The expected pattern in IUPAC codes is <code>NNNNNBNNBNNBNNBNNBNNBNNBNNBVNBNN</code>; reverse complement is performed.</li> <li><code>HDMI20</code> : 20-bp barcode format from the original Seq-Scope paper. This is intended for a small array area; reverse complement is performed.</li> <li><code>DraI31</code> : 31-bp barcode format, almost identical to <code>DraI32</code>. This format is useful for one of the example sequence data we provided, which sequenced only the first 31-bp of <code>DraI32</code> format. The expected pattern in IUPAC codes is <code>NNNNNBNNBNNBNNBNNBNNBNNBNNBVNBN</code>; reverse complement is performed.</li> </ul> </li> <li><code>--out</code> : Output directory that stores the spatial barcode dictionary per tile. See Expected Output for more details.</li> </ul>"},{"location":"tools/build_sbcds/#additional-options","title":"Additional Options","text":"<ul> <li><code>--platform</code> : Platform on which the FASTQ file is generated. This specifies the expected format of the read name. The key fields extracted are <code>LANE</code>, <code>TILE</code>, <code>X</code>, <code>Y</code> coordinates. Currently, the only officially supported format is <code>Illumina</code> (Other experimental formats are not documented here and will not be supported).<ul> <li><code>Illumina</code> : Illumina read name should have the following format: <code>[INSTRUMENT_ID]:[RUN_ID]:[FLOWCELL_ID]:[LANE]:[TILE]:[X]:[Y]</code>. </li> </ul> </li> <li><code>--force-lane</code> : (For experimental platforms only) Force the lane number to a certain value; this is useful for certain platforms where the read name does not contain the lane information. </li> </ul>"},{"location":"tools/build_sbcds/#expected-output","title":"Expected Output","text":"<p>In the output directory <code>[outdir]</code>, the following files will be created.</p> <ul> <li><code>[outdir]/manifest.tsv</code> contains the list of output tsv files. Each line contains the following information:<ul> <li><code>id</code> : ID of the tile as <code>[lane]_[tile]</code></li> <li><code>filepath</code> : Output file name associated with the tile <code>[lane]_[tile].sbcds.sorted.tsv.gz</code>. Note that the output is an unsorted tsv file, which must be sorted externally.</li> <li><code>barcodes</code> : The total number of spatial barcodes found in the tile.</li> <li><code>matches</code> : The number of barcodes matching the expected format.</li> <li><code>mismatches</code> : The number of barcodes that do not match the expected format.</li> <li><code>xmin</code> : The minimum value of the x coordinate per tile</li> <li><code>xmax</code> : The maximum value of the x coordinate per tile</li> <li><code>ymin</code> : The minimum value of the y coordinate per tile.</li> <li><code>ymax</code> : The maximum value of the y coordinate per tile.</li> </ul> </li> <li>For each tile, <code>[outdir]/[lane]_[tile].sbcds.unsorted.tsv</code> contains the barcode sequences and their spatial coordinates in tsv format. Note that the output is an unsorted tsv file, which must be sorted alphabetically and compressed into <code>[lane]_[tile].sbcds.sorted.tsv.gz</code> after <code>build-sbcds</code> has finished. Each column in the tsv file contains the following information:<ol> <li>Spatial barcode sequences (in reverse complement if the specified format requires it).</li> <li>Lane </li> <li>Tile</li> <li>x-coordinate</li> <li>y-coordinate</li> <li>Number of bases that do not match the expected pattern defined by the format (0 is a perfect match).</li> </ol> </li> </ul>"},{"location":"tools/build_sbcds/#full-usage","title":"Full Usage","text":"<p>The full usage of <code>spatula build-sbcds</code> can be viewed with the <code>--help</code> option:</p> <pre><code>$ ./spatula build-sbcds --help\n[./spatula build-sbcds] -- Create spatial barcode dictionary based from HDMI FASTQ arrays\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --fq         [STR: ]             : Input FASTQ file that contains spatial barcode in the readname\n   --format     [STR: ]             : Format of the spatial barcodes (e.g. DraI32, HDMI20, T7-30, etc)\n   --platform   [STR: Illumina]     : Platform of the sequencing data to determine the rule to parse the readnames (e.g. Illumina)\n   --force-lane [INT: 0]            : Force a lane number. Required a positive value for Salus/SalusGlobal platforms\n\n== Output Options ==\n   --out        [STR: ]             : Output directory name\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/combine_sbcds/","title":"spatula combine-sbcds","text":""},{"location":"tools/combine_sbcds/#summary","title":"Summary","text":"<p><code>spatula combine-sbcds</code> combines spatial barcodes across multiple tiles based on a specified layout of tiles. This tool can be used to generate a spatial barcode map for each 'Chip', a physical unit of spatial transcriptomic experiment, in Seq-Scope platform. </p> <p>Here is a summary of the main features:</p> <ul> <li>Input: Takes (a) a spatial barcode directory from <code>build-sbcds</code> with <code>--sbcd</code>, (b) a manifest file summarizing the files in <code>build-sbcds</code> with <code>--manifest</code>, and \u00a9 a tile layout for the specified Chip with <code>--layout</code>. Additional options may be used. </li> <li>Output: Produces a combined map of spatial barcodes in the output directory, containing a single sorted spatial barcode in <code>tsv.gz</code> format with <code>manifest.tsv</code> file. The output spatial coordinates are converted to nanometer scale.</li> </ul> <p>An example use of the tool is as follows:</p> <p><pre><code>spatula combine-sbcds --layout /path/to/layout.tsv \\\n                      --manifest /path/to/manifest.tsv \\\n                      --sbcd /path/to/sbcd/dir/ \\\n                      --out /path/to/output/dir/ \\\n                      --rowgap 0.0517 --colgap --0.0048 \\\n                      --max-dup 1 --max-dup-dist-nm 1\n</code></pre> See below for a more detailed usage description.</p>"},{"location":"tools/combine_sbcds/#required-options","title":"Required options","text":"<ul> <li><code>--sbcd</code> : The path to the directory containing spatial barcode files, generated by <code>build-sbcds</code>.</li> <li><code>--manifest</code> : The <code>manifest.tsv</code> file containing the summary of each file, generated by <code>build-sbcds</code>.</li> <li><code>--layout</code> : The layout file specifying the spatial arrangement of the tiles to be combined. (If <code>--layout</code> is not available, an <code>--offset</code> file can be specified instead). The layout file must contain the following columns:<ul> <li><code>lane</code> : The lane number of the tile (can be replaced by the <code>id</code> column)</li> <li><code>tile</code> : The tile number of the tile (can be replaced by the<code>id</code> column)</li> <li><code>row</code> : The row number of the tile</li> <li><code>col</code> : The column number of the tile</li> <li><code>rowshift</code> : (Optional) Vertical shift of the row coordinate in proportion to the tile height.</li> <li><code>colshift</code> : (Optional) Horizontal shift of the column coordinate in proportion to the tile width.</li> <li><code>id</code> : (Optional) The ID of each tile, in the format of <code>lane_tile</code> can be used instead of the <code>lane</code> and <code>tile</code> columns.</li> </ul> </li> <li><code>--out</code> : The output directory that stores the combined spatial barcode file and a manifest file. See Expected Output for more details.</li> </ul>"},{"location":"tools/combine_sbcds/#additional-options","title":"Additional options","text":"<ul> <li><code>--offset</code> : The offset file can be used instead of <code>--layout</code> to specify the spatial arrangement of  tiles. If the spatial arrangement between tiles is more complicated than a grid-like arrangement, the offset tile can handle a more general arrangement format. The offset file should contain the following columns:<ul> <li><code>lane</code> : The lane number of the tile (can be replaced by the <code>id</code> column)</li> <li><code>tile</code> : The tile number of the tile (can be replaced by the <code>id</code> column)</li> <li><code>offset_x</code> : The offset for the x-coordinate. This is an offset to add to the x-coordinate of the tile in the scale of (original) pixels per tile.</li> <li><code>offset_y</code> : The offset for the y-coordinate. This is an offset to add to the y-coordinate of the tile in the scale of (original) pixels per tile.</li> <li><code>id</code> : (Optional) The ID of each tile, in the format of <code>lane_tile</code> can be used instead of the <code>lane</code> and <code>tile</code> columns.</li> </ul> </li> <li><code>--pixel-to-nm</code> : The resolution to pixel coordinates to nanometer scale. The default is 34.78 nm/pixel, which is the resolution of the Seq-Scope platform with Illumina Nova-seq 6000. For Seq-Scope platform with Illumina HiSeq 2500, the resolution is 37.5 nm/pixel. </li> <li><code>--rowgap</code> : The additional gap between rows, proportional to the maximum height of the tiles. This is used to adjust the spatial coordinates of the tiles. The default value is 0.0.</li> <li><code>--colgap</code> : The additional gap between columns, proportional to the maximum width of the tiles. This is used to adjust the spatial coordinates of the tiles. The default value is 0.0.</li> <li><code>--match-len</code> : The length of the spatial barcode to be considered for a match. The default is 27. The maximum possible value is 27.</li> <li><code>--max-dup</code> : The number of duplicates to allow for each spatial barcode, within the maximum distance threshold specified by <code>--max-dup-dist-nm</code>. The default  is 1, which means no duplicates are allowed.</li> <li><code>--max-dup-dist-nm</code> : The maximum distance in nanometers allowed for duplicates. The default is 1000.0 nm.</li> <li><code>--write-all</code> : Write all spatial barcodes to the output file, including duplicate and filtered reads. By default, only the unique spatial barcodes that pass the filtering threshold are written to the output file.</li> </ul>"},{"location":"tools/combine_sbcds/#expected-output","title":"Expected Output","text":"<p>In the output directory <code>[outdir]</code>, the following files will be created.</p> <ul> <li><code>[outdir]/manifest.tsv</code> : The manifest file containing the information of the combined spatial barcode file. The line contains the following information:<ul> <li><code>id</code> : ID of the tile as <code>[lane]_[tile]</code></li> <li><code>filepath</code> : The filename of the combined spatial barcode map, which will be <code>1_1.sbcds.sorted.tsv.gz</code> because there will be only a single lane and tile (<code>1_1</code>) in the output.</li> <li><code>barcodes</code> : The total number of spatial barcodes found in the tile.</li> <li><code>matches</code> : The number of barcodes that match the expected format.</li> <li><code>mismatches</code> : The number of barcodes that do not match the expected format.</li> <li><code>xmin</code> : The minimum value of the x coordinate in nanometers.</li> <li><code>xmax</code> : The maximum value of the x coordinate in nanometers.</li> <li><code>ymin</code> : The minimum value of the y coordinate in nanometers.</li> <li><code>ymax</code> : The maximum value of the y coordinate in nanometers.</li> </ul> </li> <li><code>[outdir]/1_1.sbcds.sorted.tsv.gz</code> : The combined spatial barcode file in compressed <code>tsv</code> format. Each column in the tsv file contains the following information:<ol> <li>Spatial barcode sequences (in reverse complement, if specified in the format).</li> <li>Lane (always 1)</li> <li>Tile (always 1)</li> <li>x-coordinate in nanometer scale</li> <li>y-coordinate in nanometer scale</li> <li>Number of bases mismatching to the expected pattern defined by the format (0 is perfect match).</li> </ol> </li> <li><code>[outdir]/dupstats.tsv.gz</code> : Duplicate barcode statistics. For each duplicate barcode, the number of duplicates and the maximum distance between them (if within the <code>--max-dup-dist-nm</code> threshold) are reported.</li> </ul>"},{"location":"tools/combine_sbcds/#full-usage","title":"Full Usage","text":"<p>The full usage of the software tool is as follows:</p> <pre><code>$ ./spatula combine-sbcds --help\n[./spatula combine-sbcds] -- Combine multiple SBCD files\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --layout              [STR: ]             : Layout file, each containing [lane] [tile] and [row]/[col] as columns\n   --offset              [STR: ]             : Offset file, each containing [lane] [tile] and [row]/[col] as columns\n   --sbcd                [STR: ]             : Directory containing spatial barcode files\n   --manifest            [STR: ]             : Manifest file containing the list of spatial barcode files\n   --require-exact-match [FLG: OFF]          : Require exact match between manifest file and layout file. If false, layout can only contain subset of tiles in the manifest file\n\n== Output Options ==\n   --out                 [STR: ]             : Output spatial barcode file after merging\n   --write-all           [FLG: OFF]          : Write all spatial barcodes to the output file, including duplicated and filtered reads\n\n== Options for coordinate conversion ==\n   --pixel-to-nm         [FLT: 34.78]        : Pixel to nm conversion factor (37.5 for Seq-Scope)\n   --rowgap              [FLT: 0.00]         : Additional gap between rows (proportional to the height of a tile)\n   --colgap              [FLT: 0.00]         : Additional gap between columns (proportional to the width of a tile)\n\n== Options for duplicate filtering ==\n   --match-len           [INT: 27]           : Length of HDMI spatial barcode to be considered for a match\n   --max-dup             [INT: 1]            : Maximum number of duplicates allowed for each spatial barcode. If this is 1, duplicates are not allowed\n   --max-dup-dist-nm     [FLT: 10000.00]     : Maximum distance allowed for duplicates in nm scale\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/custom_demux_fastq/","title":"spatula custom-demux-fastq","text":""},{"location":"tools/custom_demux_fastq/#summary","title":"Summary","text":"<p><code>spatula custom-demux-fastq</code> takes FASTQ files of sequenced reads and indexes to demultiplex the reads by sample. Compared to the default FASTQ demultiplexing tool provided by Illumina, <code>custom-demux-fastq</code> allows users to specify the matching criteria in a more flexible way. Specifically, the software performs demultiplexing based on the following criteria: * Unlike the default Illumina demultiplexing tool, <code>custom-demux-fastq</code> does not consider <code>N</code> as mismatches (by default). * The software allows users to specify the number of mismatches allowed to be considered as the match. * It also requires that the 2<sup>nd</sup>-best matching index sequences have larger hamming distance with the index sequences with a specific margin, compared to the best matching index sequences.</p> <p>Note that this tool is NOT limited to demultiplexing spatial transcriptomics sequence data, and can be used for a general tool for demultiplexing FASTQ files as well.</p> <p>Also note that this tool uses multi-process parallelization to speed up the compression. It is recommended to run this tool with at least 5-10 CPUs. <code>gzip</code> or <code>pigz</code> must be installed in the system to compress the output files.</p> <p>Here is a summary of a typical use case:</p> <ul> <li>Input: Takes FASTQ files that contain (a) Read 1, (b) Read 2 (optional), \u00a9 Index 1, (d) Index 2 (optional) sequences.</li> <li>Output: Produces multiple sets of FASTQs separated by the sample identity.</li> </ul> <p>A typical example is as follows:</p> <pre><code>spatula custom-demux-fastq --R1 /path/to/input.R1.fastq.gz \\\n                           --R2 /path/to/input.R2.fastq.gz \\\n                           --I1 /path/to/input.I1.fastq.gz \\\n                           --sample /path/to/sample.index.tsv \\\n                           --out /path/to/output_prefix\n</code></pre> <p>See below for a more detailed usage description.</p>"},{"location":"tools/custom_demux_fastq/#key-options","title":"Key options","text":"<ul> <li><code>--R1</code> : (Required) The path to the FASTQ file of Read 1.</li> <li><code>--R2</code> : (Optional) The path to the FASTQ file of Read 2.</li> <li><code>--I1</code> : (Required) The path to the FASTQ file of Index 1.</li> <li><code>--I2</code> : (Optional) The path to the FASTQ file of Index 2.</li> <li><code>--sample</code> : (Required) Sample index file in <code>tsv</code> format, with the following three columns:<ul> <li><code>ID</code> : Sample ID. Must be unique.</li> <li><code>I1</code> : Index 1 sequence.</li> <li><code>I2</code> : Index 2 sequence (if available). </li> </ul> </li> <li><code>--out</code> : (Required) The prefix of the output file ([out_prefix].[sample_ID][suffix]) paths. See Expected Output for more details.</li> </ul>"},{"location":"tools/custom_demux_fastq/#additional-options","title":"Additional Options","text":"<ul> <li><code>--cmd</code> : The command to run for compressing output files. Each file is compressed with the command specified. The default is <code>gzip -c</code>. Another popular choice could be <code>pigz -p 4 -c</code>, which is faster than <code>gzip -c</code> if <code>pigz</code> is installed.</li> <li><code>--max-mismatch</code> : The maximum number of mismatches allowed to be considered as a match. The default is 2.</li> <li><code>--min-diff</code> : Minimum difference in the hamming distance with the index sequence between the best and second best match. The default is 2.</li> <li><code>--suffix-R1</code> : The suffix of Read 1 output files. The default is <code>.R1.fastq.gz</code>.</li> <li><code>--suffix-R2</code> : The suffix of Read 2 output files. The default is <code>.R2.fastq.gz</code>.</li> <li><code>--suffix-I1</code> : The suffix of Index 1 output files. The default is <code>.I1.fastq.gz</code>.</li> <li><code>--suffix-I2</code> : The suffix of Index 2 output files. The default is <code>.I2.fastq.gz</code>.</li> <li><code>--ambiguous</code> : The sample ID of the ambiguously demultiplexed reads. The default is <code>ambiguous</code>.</li> </ul>"},{"location":"tools/custom_demux_fastq/#expected-output","title":"Expected Output","text":"<p>With <code>[out_prefix]</code> as the prefix, and <code>[sample_ID]</code> be the ID of best-matching samples, the following files will be created: * <code>[out_prefix].[sample_ID].R1.fastq.gz</code> : The FASTQ file of Read 1 for the sample. * <code>[out_prefix].[sample_ID].R2.fastq.gz</code> : The FASTQ file of Read 2 for the sample (if available). * <code>[out_prefix].[sample_ID].I1.fastq.gz</code> : The FASTQ file of Index 1 for the sample. * <code>[out_prefix].[sample_ID].I2.fastq.gz</code> : The FASTQ file of Index 2 for the sample (if available). * If the suffix is specified with <code>--suffix-R1</code>, <code>--suffix-R2</code>, <code>--suffix-I1</code>, <code>--suffix-I2</code>, the suffix will be replaced with the specified suffix.</p>"},{"location":"tools/custom_demux_fastq/#full-usage","title":"Full Usage","text":"<p>The full usage of <code>spatula subset-sge</code> can be viewed with the <code>--help</code> option:</p> <pre><code>$ ./spatula custom-demux-fastq --help\n[./spatula custom-demux-fastq] -- Demultiplex FASTQ files based in a customized manner\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --R1                     [STR: ]             : FASTQ file for read 1\n   --R2                     [STR: ]             : FASTQ file for read 2\n   --I1                     [STR: ]             : FASTQ file for index 1\n   --I2                     [STR: ]             : FASTQ file for index 2\n   --sample                 [STR: ]             : Sample sheet file containing [ID] [I1] [I2]\n\n== Settings ==\n   --cmd                    [STR: gzip -c]      : Command to compress the output files\n   --consider-N-as-mismatch [FLG: OFF]          : Consider N as mismatch (default: false)\n   --max-mismatch           [INT: 2]            : Maximum number of mismatch allowed\n   --min-diff               [INT: 2]            : Minimum difference between the best and second best match\n\n== Output Options ==\n   --out                    [STR: ]             : Output prefix\n   --suffix-R1              [STR: .R1.fastq.gz] : Output suffix for read 1\n   --suffix-R2              [STR: .R2.fastq.gz] : Output suffix for read 2\n   --suffix-I1              [STR: .I1.fastq.gz] : Output suffix for index 1\n   --suffix-I2              [STR: .I2.fastq.gz] : Output suffix for index 2\n   --ambiguous              [STR: ambiguous]    : The keyword for ambiguous samples (default: ambiguous)\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/dge2sge/","title":"spatula dge2sge","text":""},{"location":"tools/dge2sge/#summary","title":"Summary","text":"<p><code>spatula dge2sge</code> creates the STARsolo output of digital expression, joins the spatial barcode map, and produces the spatial gene expression (SGE) matrix.</p> <p>Here is a summary of a typical use case:</p> <ul> <li>Input: Takes (a) a spatial barcode map of matching barcodes produced from <code>match-sbcds</code>) and (b)  10X-format digital expression matrix (with <code>barcodes.tsv.gz</code>, <code>feature.tsv.gz</code>, and one or more <code>matrix.mtx.gz</code>).</li> <li>Output: Produces spatially coordinated gene expression (SGE) matrix, which is similar to the 10X format, but (a) with additional information such as spatial coordinates, and (b) with the ability to annotate multiple types of readout in a single output matrix.</li> </ul> <p>An example usage of the tool is as follows:</p> <pre><code>spatula dge2sge  --match /path/to/input.match.sorted.uniq.tsv.gz \\\n                 --bcd /path/to/STARsolo.out/GeneFull/raw/barcodes.tsv.gz \\\n                 --ftr /path/to/STARsolo.out/GeneFull/raw/features.tsv.gz \\\n                 --mtx /path/to/STARsolo/out/Gene/raw/matrix.mtx.gz \\\n                 --mtx /path/to/STARsolo.out/GeneFull/raw/matrix.mtx.gz \\\n                 --mtx /path/to/STARsolo.out/Velocyto/raw/spliced.mtx.gz \\\n                 --mtx /path/to/STARsolo.out/Velocyto/raw/unspliced.mtx.gz \\\n                 --mtx /path/to/STARsolo.out/Velocyto/raw/ambiguous.mtx.gz \\\n                 --out /path/to/output/dir/\n</code></pre> <p>See below for a more detailed usage description.</p>"},{"location":"tools/dge2sge/#required-options","title":"Required options","text":"<ul> <li><code>--match</code> : The path to the spatial barcode map (<code>*.match.sorted.uniq.tsv.gz</code>) file that contains matching barcodes to the 2<sup>nd</sup>-seq FASTQ file, generated by <code>match-sbcds</code>. Instead of <code>--match</code>, the full sbcd directory can be used with <code>--sbcd</code> option (see Additional options for details).</li> <li><code>--bcd</code> : The path to the <code>barcodes.tsv.gz</code> file that contains the full list of barcodes from the STARsolo output. Each line contains a column of barcode sequence, following the Market Exchange format</li> <li><code>--ftr</code> : The path to the <code>features.tsv.gz</code> file that contains the full list of genes (or features) from the STARsolo output. Each line contains three columns: <code>gene_id</code>, <code>gene_name</code>, and <code>feature_type</code>, following the Market Exchange format</li> <li><code>--mtx</code> : (allows multiple entries) The path to the <code>matrix.mtx.gz</code> file that contains the digital expression matrix from the STARsolo output. After three header lines, the matrix file contains (a) barcode index (1-based), (b) gene index (1-based), and \u00a9 count, the Market Exchange format. Multiple <code>--mtx</code> options can be used as long as they share the same barcodes and feature information.</li> <li><code>--out</code> : Output directory that stores the spatial gene expression (SGE) output files. See Expected Output for more details.</li> </ul>"},{"location":"tools/dge2sge/#additional-options","title":"Additional Options","text":"<ul> <li><code>--sbcd</code> : Directory that contains the spatial barcode dictionary per tile. This can be used instead of <code>--match</code> option, if the list of matching barcodes are unavailable. </li> </ul>"},{"location":"tools/dge2sge/#expected-output","title":"Expected Output","text":"<p>In the output directory <code>[outdir]</code>, the following files will be created.</p> <ul> <li><code>[outdir]/barcodes.tsv.gz</code> contains the list of barcodes in the SGE matrix. Each line contains the following information:<ol> <li>Barcode sequence</li> <li>Increasing index of the barcode (1-based), which is not necessarily contiguous.</li> <li>Sequential and contiguous index of the barcode (1-based). This should match to the integer IDs of barcodes in the <code>matrix.mtx.gz</code> file.</li> <li>Lane of spatial coordinate</li> <li>Tile of spatial coordinate</li> <li>X-coordinate of spatial coordinate</li> <li>Y-coordinate of spatial coordinate</li> <li>Comma-separated counts of observations in each <code>matrix.mtx.gz</code> file. The order of the counts should match the order of <code>--mtx</code> options.</li> </ol> </li> <li><code>[outdir]/features.tsv.gz</code> contains the list of genes in the SGE matrix. Each line contains the following information:<ol> <li>Gene ID (unique identifier)</li> <li>Gene name</li> <li>Sequential and contiguous index of the gene (1-based). This should match to the integer IDs of genes in the <code>matrix.mtx.gz</code> file.</li> <li>Comma-separated counts of observations in each <code>matrix.mtx.gz</code> file. The order of the counts should match the order of <code>--mtx</code> options.</li> </ol> </li> <li><code>[outdir]/matrix.mtx.gz</code> contains the spatial expression matrix in the SGE format. After three header lines following the Market Exchange format, the matrix file contains the following information, separated by spaces.<ol> <li>barcode index (1-based)</li> <li>gene index (1-based)</li> <li>(multiple space-separated entries) counts of observations, in the order of input files in <code>--mtx</code> options.</li> </ol> </li> <li><code>[outdir]/[lane]</code> directory contains <code>barcodes.tsv.gz</code>, <code>features.tsv.gz</code>, and <code>matrix.mtx.gz</code>, for the specific lane, in the same format.</li> <li><code>[outdir]/[lane]/[tile]</code> directory contains <code>barcodes.tsv.gz</code>, <code>features.tsv.gz</code>, and <code>matrix.mtx.gz</code>, for the specific tile, in the same format.</li> </ul>"},{"location":"tools/dge2sge/#full-usage","title":"Full Usage","text":"<p>The full usage of <code>spatula dge2sdge</code> can be viewed with the <code>--help</code> option:</p> <pre><code>$  ./spatula dge2sge --help   \n[./spatula dge2sge] -- Convert DGE (from STARsolo) into SGE format\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --sbcd  [STR: ]             : Spatial barcode dictionary generated from 'build-sbcds' command\n   --match [V_STR: ]           : List of spatial barcode files that were used for whitelist generation\n   --bcd   [STR: ]             : Shared barcode file path (e.g. barcodes.tsv.gz)\n   --ftr   [STR: ]             : Shared feature file path (e.g. feature.tsv.gz)\n   --mtx   [V_STR: ]           : Shared matrix file path (e.g. matrix.mtx.gz)\n\n== Output Options ==\n   --out   [STR: ]             : Output directory\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/draw_3way/","title":"spatula draw-3way","text":""},{"location":"tools/draw_3way/#summary","title":"Summary","text":"<p><code>spatula draw-3way</code> is a tool to visualize the spatial distribution of 1<sup>st</sup>-seq and 2<sup>nd</sup>-seq reads of Seq-Scope data for each 'Chip'.</p> <p>IMPORTANT ImageMagick must be installed to use this tool.</p> <p>A typical use case is as follows:</p> <ul> <li>Input: Takes (a) an output <code>combine-sbcds</code>, (b) (multiple) outputs <code>match-sbcds</code>, and \u00a9 output from <code>dge2sge</code> commands from individual tools.</li> <li>Output: Produces an 2D image that plots the (a) all 1<sup>st</sup>-seq spatial barcodes from <code>combine-sbcds</code> in blue, (b) all 2<sup>nd</sup>-seq spatial barcodes from <code>match-sbcds</code> in green, and \u00a9 all 2<sup>nd</sup>-seq spatial barcodes aligned to genes from <code>dge2sge</code> in red.</li> </ul> <p>A typical example is as follows:</p> <pre><code>spatula draw-3way --manifest /path/to/combine/sbcds/output/dir/manifest.tsv \\\n                  --nbcd     /path/to/combine/sbcds/output/dir/1_1.sbcds.sorted.tsv.gz \\\n                  --nmatch   /path/to/match/sbcds/output/prefix1.match.sorted.uniq.tsv.gz \\\n                  --nmatch   /path/to/match/sbcds/output/prefix2.match.sorted.uniq.tsv.gz \\\n                  --ngebcd   /path/to/dge2sge/output/dir/barcodes.tsv.gz \\\n                  --out      /path/to/output/image.png                \n</code></pre> <p>See below for a more detailed usage description.</p>"},{"location":"tools/draw_3way/#required-options","title":"Required options","text":"<ul> <li><code>--manifest</code> : The <code>manifest.tsv</code> file from the <code>combine-sbcds</code> file that contains the summary of the spatial coordinate of a Seq-Scope Chip.</li> <li><code>--nbcd</code> : The spatial barcode file from the <code>combine-sbcds</code> command. The filename is usually <code>1_1.sbcds.sorted.tsv.gz</code>.</li> <li><code>--nmatch</code> : (Multiple allowed) The spatial barcode file from the <code>match-sbcds</code> command. The filename is usually <code>prefix.match.sorted.uniq.tsv.gz</code>.</li> <li><code>--ngebcd</code> : The spatial barcode file from the <code>dge2sge</code> command. The filename is usually <code>barcodes.tsv.gz</code>.</li> <li><code>--out</code> : The output filename of the image. Currently, <code>.png</code> is supported. </li> </ul>"},{"location":"tools/draw_3way/#additional-options","title":"Additional Options","text":"<ul> <li><code>--coord-per-pixel</code> : The number of coordinates to be collapsed into a pixel as a factor to divide the input coordinate with. The default is 1000.0.</li> <li><code>--color-nbcd</code> : The RGB hex color code for the 1<sup>st</sup>-seq spatial barcodes in the order of G,B,R. The default is <code>#004800</code> (blue).</li> <li><code>--color-nmatch</code> : The RGB hex color code for the 2<sup>nd</sup>-seq spatial barcodes in the order of G,B,R. The default is <code>#640000</code> (green).</li> <li><code>--color-nge</code> : The RGB hex color code for the 2<sup>nd</sup>-seq spatial barcodes aligned to genes in the order of G,B,R. The default is <code>#000032</code> (red).</li> <li><code>--icol-x-nbcd</code> : The (0-based) column index of the X coordinate in the 1<sup>st</sup>-seq spatial barcode file. The default is 3.</li> <li><code>--icol-y-nbcd</code> : The (0-based) column index of the Y coordinate in the 1<sup>st</sup>-seq spatial barcode file. The default is 4.</li> <li><code>--icol-x-nmatch</code> : The (0-based) column index of the X coordinate in the 2<sup>nd</sup>-seq spatial barcode file. The default is 3.</li> <li><code>--icol-y-nmatch</code> : The (0-based) column index of the Y coordinate in the 2<sup>nd</sup>-seq spatial barcode file. The default is 4.</li> <li><code>--icol-x-ngebcd</code> : The (0-based) column index of the X coordinate in the 2<sup>nd</sup>-seq spatial barcode file. The default is 5.</li> <li><code>--icol-y-ngebcd</code> : The (0-based) column index of the Y coordinate in the 2<sup>nd</sup>-seq spatial barcode file. The default is 6.</li> <li><code>--icol-gene-ngebcd</code> : The (0-based) column index of the gene count in the 2<sup>nd</sup>-seq spatial barcode file. The default is 7.</li> <li><code>--isubcol-gene-ngebcd</code> : The (0-based) sub column index of the gene count (among the comma-separated-values) in the 2<sup>nd</sup>-seq spatial barcode file. The default is 0.</li> <li><code>--id-manifest</code> : The ID of the tile in the manifest file to use. The default is <code>1_1</code>.</li> </ul>"},{"location":"tools/draw_3way/#expected-output","title":"Expected Output","text":"<p>The output <code>[out]</code> will be created as a PNG file containing the image of the input points.</p>"},{"location":"tools/draw_3way/#full-usage","title":"Full Usage","text":"<p>The full usage of <code>spatula draw-3way</code> can be viewed with the <code>--help</code> option:</p> <pre><code>$ ./spatula draw-3way --help\n[./spatula draw-3way] -- Draw the 3-way image from the output of sttools pipeline\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input files ==\n   --manifest            [STR: ]             : Manifest file from combine-sbcds. xmin/xmax/ymin/ymax will be automatically detected\n   --nbcd                [STR: ]             : Spatial barcode dictionary generated from 'combine-sbcds' command\n   --nmatch              [V_STR: ]           : Spatial barcode dictionary generated from 'match-sbcds' command\n   --ngebcd              [STR: ]             : Spatial barcode dictionary generated from alignment pipeline\n\n== Input options ==\n   --icol-x-nbcd         [INT: 3]            : 0-based index of the column for x in nbcd\n   --icol-y-nbcd         [INT: 4]            : 0-based index of the column for y in nbcd\n   --icol-x-nmatch       [INT: 3]            : 0-based index of the column for x in nmatch\n   --icol-y-nmatch       [INT: 4]            : 0-based index of the column for y in nmatch\n   --icol-x-ngebcd       [INT: 5]            : 0-based index of the column for x in ngebcd\n   --icol-y-ngebcd       [INT: 6]            : 0-based index of the column for y in ngebcd\n   --icol-gene-ngebcd    [INT: 7]            : 0-based index of the column for gene count in ngebcd\n   --isubcol-gene-ngebcd [INT: 0]            : 0-based index of the sub column for gene count in ngebcd (0: Gene, 1: GeneFull, ...)\n   --id-manifest         [STR: 1_1]          : ID of the tile in the manifest file to use\n\n== Output options ==\n   --coord-per-pixel     [FLT: 1000.00]      : Number of coordinate units per pixel\n   --color-nbcd          [STR: #004800]      : RGB hex color code for nbcd per observation\n   --color-nmatch        [STR: #640000]      : RGB hex color code for nmatch per observation\n   --color-nge           [STR: #000032]      : RGB hex color code for nge per observation\n\n== Output Options ==\n   --out                 [STR: ]             : Output file name\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/draw_xy/","title":"spatula draw-xy","text":""},{"location":"tools/draw_xy/#summary","title":"Summary","text":"<p><code>spatula draw-xy</code> is a simple tool that draws an image of 2D points provided as an input. </p> <p>IMPORTANT ImageMagick must be installed to use this tool.</p> <p>A typical use case is as follows:</p> <ul> <li>Input: TSV file (or can be streamed from STDIN), that contains X and Y coordinates of individual points to be plotted. </li> <li>Output: Produces a grayscale 2D image that plots all the input points based on the specified scaling factor and intensity.</li> </ul> <p>A typical example is as follows:</p> <pre><code>spatula draw-xy --tsv /path/to/input.tsv.gz \\\n                --out /path/to/output.png \\\n                --coord-per-pixel 1000 \\\n                --icol-x 3 \\\n                --icol-y 4 \\\n                --intensity-per-obs 50\n</code></pre> <p>See below for a more detailed usage description.</p>"},{"location":"tools/draw_xy/#required-options","title":"Required options","text":"<ul> <li><code>--tsv</code> : The input TSV file that contains spatial coordinates of the points. <code>/dev/stdin</code> can be used to stream the input from STDIN.</li> <li><code>--out</code> : The output filename of the image. Currently, <code>.png</code> is supported. </li> </ul>"},{"location":"tools/draw_xy/#additional-options","title":"Additional Options","text":"<ul> <li><code>--width</code> : The width of the output image. If not specified, the width will be determined based on the minimum and maximum coordinates of the input points.</li> <li><code>--height</code> : The height of the output image. If not specified, the height will be determined based on the minimum and maximum coordinates of the input points.</li> <li><code>--coord-per-pixel</code> : The number of coordinates to be collapsed into a pixel as a factor to divide the input coordinate with. The default is 1.0.</li> <li><code>--intensity-per-obs</code> : The intensity (max 255) of individual points to contribute to the pixel. The default is 1.0.</li> <li><code>--icol-x</code> : The (0-based) column index of the X coordinate in the input TSV file. The default is 0.</li> <li><code>--icol-y</code> : The (0-based) column index of the Y coordinate in the input TSV file. The default is 1.</li> </ul>"},{"location":"tools/draw_xy/#expected-output","title":"Expected Output","text":"<p>The output <code>[out]</code> will be created as a PNG file containing the image of the input points.</p>"},{"location":"tools/draw_xy/#full-usage","title":"Full Usage","text":"<p>The full usage of <code>spatula draw-xy</code> can be viewed with the <code>--help</code> option:</p> <pre><code>$ ./spatula draw-xy --help           \n[./spatula draw-xy] -- Draw the image of points in 2D space\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --tsv               [STR: ]             : tsv file to draw the x-y coordinates. /dev/stdin for stdin\n   --icol-x            [INT: 0]            : 0-based index of the column for x\n   --icol-y            [INT: 1]            : 0-based index of the column for y\n\n== Settings ==\n   --width             [INT: 0]            : Width of the image\n   --height            [INT: 0]            : Height of the image\n   --coord-per-pixel   [FLT: 1.00]         : Number of coordinate units per pixel\n   --intensity-per-obs [INT: 1]            : Intensity per pixel per observation\n\n== Output Options ==\n   --out               [STR: ]             : Output file name\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/eval_dups_sbcds/","title":"spatula eval-dups-sbcds","text":""},{"location":"tools/eval_dups_sbcds/#summary","title":"Summary","text":"<p><code>spatula eval-dups-sbcds</code> examines duplicates in the spatial barcode dictionary generated by <code>spatula build-sbcds</code> and produces summary statistics.</p> <p>Here is a summary of the main features:</p> <ul> <li>Input: Takes a spatial barcode directory from <code>build-sbcds</code>.</li> <li>Output: In the output directory, it produces (a) a complete list of duplicate barcodes, with the number of occurrences and the number of unique tiles observed, (b) per-tile summary metrics of the number of duplicate barcodes, and \u00a9 the histogram of the observed counts of each duplicate.</li> </ul> <p>An example use of the tool is as follows:</p> <p><pre><code>spatula eval-dups-sbcds --sbcd /path/to/sbcd/dir/ \\\n                        --out  /path/to/output_prefix \n</code></pre> See below for a more detailed usage description.</p>"},{"location":"tools/eval_dups_sbcds/#required-options","title":"Required options","text":"<ul> <li><code>--sbcd</code> : The path to the directory containing spatial barcode files, generated by <code>build-sbcds</code>.</li> <li><code>--out</code> : The prefix for the output files. See Expected Output for more details.</li> </ul>"},{"location":"tools/eval_dups_sbcds/#additional-options","title":"Additional options","text":"<ul> <li><code>--match-len</code> : The length of the spatial barcode to consider for a match. The default  is 27, and the maximum possible value is 27.</li> </ul>"},{"location":"tools/eval_dups_sbcds/#expected-output","title":"Expected Output","text":"<p>With <code>[out_prefix]</code> as the prefix, the following files will be created:</p> <ul> <li><code>[out_prefix].dups.sbcds.tsv.gz</code> : A compressed tsv file containing the following entries in each line:<ul> <li><code>barcode</code> : Spatial barcode that is observed multiple times across the tiles.</li> <li><code>ntiles</code> : Number of unique tiles where the spatial barcodes were observed.</li> <li><code>dupcount</code> : The number of occurrences of the spatial barcode across the tiles.</li> </ul> </li> <li><code>[out_prefix].tiles.tsv</code> : A tab-delimited file summarizing the duplicate barcode statistics. It contains the following entries in each row:<ul> <li><code>tile</code> : The ID of the tile, in the format of <code>lane_tile</code>.</li> <li><code>total</code> : The total number of spatial barcodes found in the tile.</li> <li><code>uniq</code> : The number of unique spatial barcodes (across tiles) found in the tile.</li> <li><code>dups_uniq</code> : The number of non-unique spatial barcodes in the tile, counting only once per tile.</li> <li><code>dups_within</code> : The number of non-unique spatial barcodes observed only within a single tile, counting only once per tile.</li> <li><code>dups_between</code> : The number of non-unique spatial barcodes observed across multiple tiles, counting only once per tile.</li> </ul> </li> <li><code>[out_prefix].hist.tsv</code> : The histogram of the observed counts of each duplicate, across all tiles. It contains the following entries in each row.<ul> <li><code>dupcount</code> : The number of occurrences of the spatial barcode across the tiles.</li> <li><code>num</code> : The number of spatial barcodes observed with the <code>dupcount</code> occurrences.</li> </ul> </li> </ul>"},{"location":"tools/eval_dups_sbcds/#full-usage","title":"Full Usage","text":"<p>The full usage of the software tool is as follows:</p> <pre><code>$ ./spatula eval-dups-sbcds --help\n[./spatula eval-dups-sbcds] -- Evaluate duplicates in spatial barcodes\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --sbcd      [STR: ]             : Spatial barcode dictionary generated from 'build-sbcds' command\n   --match-len [INT: 27]           : Length of HDMI spatial barcodes to require perfect matches\n\n== Output Options ==\n   --out       [STR: ]             : Prefix of output files (.dups.sbcds.tsv.gz, .tiles.tsv, .hist.tsv)\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/match_sbcds/","title":"spatula match-sbcds","text":""},{"location":"tools/match_sbcds/#summary","title":"Summary","text":"<p><code>spatula match-sbcds</code> matches a 2<sup>nd</sup>-seq FASTQ file with the spatial barcodes map and  identifies matching barcodes and their spatial distribution. </p> <p>Here is a summary of the main features:</p> <ul> <li>Input: Takes (a) a spatial barcode directory from <code>build-sbcds</code> or <code>combined-sbcds</code>, and (b) a 2<sup>nd</sup>-seq FASTQ file (read 1 only).</li> <li>Output: Produces (a) a full list of matching barcodes and their spatial coordinates, (b) summary metrics of reads matching to the barcodes, and \u00a9 per-tile summary metrics of matching barcodes.</li> </ul> <p>An example usage of the tool is as follows:</p> <p><pre><code>spatula match-sbcds --fq /path/to/second_seq.R1.fastq.gz \\\n                    --sbcd /path/to/sbcd/dir/ \\\n                    --skip-sbcd 1 \\\n                    --out /path/to/output_prefix\n</code></pre> See below for a more detailed usage description.</p>"},{"location":"tools/match_sbcds/#required-options","title":"Required options","text":"<ul> <li><code>--fq</code> : The path to 2<sup>nd</sup>-seq FASTQ file (read 1) that contains the sequences that should match with the spatial barcode dictionary.</li> <li><code>--sbcds</code> : The path to the spatial barcode dictionary directory, generated by <code>build-sbcds</code> or <code>combined-sbcds</code>. It should contain <code>manifest.tsv</code> file and corresponding barcode map for each tile in the manifest file.</li> <li><code>--out</code> : The prefix for the output files. See Expected Output for more details.</li> </ul>"},{"location":"tools/match_sbcds/#additional-options","title":"Additional options","text":"<ul> <li><code>--batch</code> : The size of single batch for performing the matching process. Each batch will be processed and the output will be written to temporary files, and merged at the end. The default value is 300M (300000000).  </li> <li><code>--skip-sbcd</code> : The number of bases to be skipped in the beginning of the read. This is useful when insufficient bases are sequenced in the 1<sup>st</sup>-seq spatial barcode, which is reverse complemented.  </li> <li><code>--skip-duplicates</code> : Skip  barcodes that occurs multiple times in the barcode map. By default, one of the duplicate barcodes are arbitrarily selected and written to the output.</li> <li><code>--match-len</code> : The length of the spatial barcode to consider for a match. The default is 27, and the maximum possible value is 27. </li> </ul>"},{"location":"tools/match_sbcds/#expected-output","title":"Expected Output","text":"<p>With <code>[out_prefix]</code> as the prefix, the following files will be created:</p> <ul> <li><code>[out_prefix].match.sorted.uniq.tsv.gz</code> : A compressed tsv file containing the following entries in each row:<ol> <li>Spatial barcode (alphebetically sorted) </li> <li>Lane of spatial coordinate</li> <li>Tile of spatial coordinate</li> <li>X-coordinate of spatial coordinate</li> <li>Y-coordinate of spatial coordinate</li> <li>Number of bases that do not match the expected pattern defined by the format (0 is a perfect match).</li> <li>Number of occurrences in the 2<sup>nd</sup>-seq FASTQ file.</li> </ol> </li> <li><code>[out_prefix].summary.tsv</code> : A tab-delimited file summarizing the overall statistics of matching barcode<ul> <li><code>Type</code> : The type of statistics, including the following values:<ul> <li><code>Total</code> : All reads in the 2<sup>nd</sup>-seq FASTQ file.</li> <li><code>Miss</code> : Reads that do not contain matching spatial barcodes.</li> <li><code>Match</code> : Reads that match with a spatial barcode.</li> <li><code>Unique</code> : Unique spatial barcodes that has matches.</li> <li><code>Dup(Exact)</code> : Duplicate barcodes calculated as <code>Match</code> - <code>Unique</code>.</li> </ul> </li> <li><code>Reads</code> : The number of reads or barcodes that match the type.</li> <li><code>Fraction</code> : The fraction of the reads (among all reads) that match the type.</li> </ul> </li> <li><code>[out_prefix].counts.tsv</code> : A tab-delimited file summarizing the matching barcode statistics per tile. It contains the following entries in each row:<ul> <li><code>id</code> : The ID of the tile, in the format of <code>lane_tile</code>.</li> <li><code>filepath</code> : The name of the <code>tsv.gz</code> file containing spatial barcode map.</li> <li><code>barcodes</code> : The total number of spatial barcodes found in the tile.</li> <li><code>matches</code> : The number of barcodes that match the expected format.</li> <li><code>unique</code> : The number of unique barcodes that match the expected format.</li> </ul> </li> </ul>"},{"location":"tools/match_sbcds/#full-usage","title":"Full Usage","text":"<p>The full usage of the software tool is as follows:</p> <pre><code>$ ./spatula match-sbcds --help    \n[./spatula match-sbcds] -- Match the FASTQ file containing spatial barcodes with the spatial barcode dictionary\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --fq              [STR: ]             : FASTQ file read 1 containing 2nd-seq spatial barcode\n   --sbcd            [STR: ]             : Spatial barcode dictionary generated from 'build-sbcds' command\n   --batch           [INT: 300000000]    : Size of a single batch\n   --skip-sbcd       [INT: 0]            : Skip first bases of spatial barcode (Read 1)\n   --match-len       [INT: 27]           : Length of HDMI spatial barcodes to require perfect matches\n   --skip-duplicates [FLG: OFF]          : Skip duplicate barcodes that occurs multiple times\n\n== Output Options ==\n   --out             [STR: ]             : Output prefix (index.tsv, matches.tsv.gz)\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/reformat_fastqs/","title":"spatula reformat-fastqs","text":""},{"location":"tools/reformat_fastqs/#summary","title":"Summary","text":"<p><code>spatula reformat-fastqs</code> takes paired-end FASTQ files and reformats it into a format that can be used by <code>STARsolo</code> by filtering out irrelevant reads while arranging the barcodes and UMI sequences. Specifically, the software achieves the following: * Filter out reads that does not have matching barcode sequences in the spatial barcode dictionary. * Reformat the Read 1 sequences to be compatible with <code>STARsolo</code>, by copying the UMI sequences next to the spatial barcode sequences in Read 1. * Trim Read 2 sequences to a specified length, which typically helps increase the mapping rates. * If needed, trim the beginning of Read 1 sequences to match the spatial barcode sequences.</p> <p>Here is a summary of a typical use case:</p> <ul> <li>Input: Takes (a) a pair of FASTQ files and (b) tsv files containing spatial barcodes to be matched.</li> <li>Output: Produces a pair of (uncompressed) FASTQ files after filtering reads and rearranging the part of sequences. </li> </ul> <p>A typical example is as follows:</p> <pre><code>spatula reformat-fastqs --fq1 /path/to/input.R1.fastq.gz \\\n                        --fq2 /path/to/input.R2.fastq.gz \\\n                        --match-tsv /path/to/match_sbcds_prefix1.match.sorted.uniq.tsv.gz \\\n                        --match-tsv /path/to/match_sbcds_prefix2.match.sorted.uniq.tsv.gz \\\n                        --match-tsv /path/to/match_sbcds_prefix3.match.sorted.uniq.tsv.gz \\\n                        --skip-sbcd 1 \\\n                        --len-sbcd 31 \\\n                        --len-umi 9 \\\n                        --len-r2 101 \\\n                        --out1 /path/to/output.R1.fastq \\\n                        --out2 /path/to/output.R2.fastq\n</code></pre> <p>See below for a more detailed usage description.</p>"},{"location":"tools/reformat_fastqs/#required-options","title":"Required options","text":"<ul> <li><code>--fq1</code> : The path to the FASTQ file of Read 1, which typically contains spatial barcode sequences.</li> <li><code>--fq2</code> : The path to the FASTQ file of Read 2, which typically contains UMI sequences and cDNA sequences.</li> <li><code>--match-tsv</code> : (Multiples allowed) The output <code>match.sorted.uniq.tsv.gz</code> file from <code>spatula match-sbcds</code> that contains the spatial barcode sequences to be matched. </li> <li><code>--out1</code> : The path to the output FASTQ files of Read 1.</li> <li><code>--out2</code> : The path to the output FASTQ files of Read 2. See Expected Output for more details.</li> </ul>"},{"location":"tools/reformat_fastqs/#additional-options","title":"Additional Options","text":"<ul> <li><code>--len-match</code> : The length of the spatial barcode to consider for a match. The default is 27, and the maximum possible value is 27.</li> <li><code>--len-sbcd</code> : The length of the spatial barcode sequence to be copied in Read 1. The default is 30, and must be equal or smaller than actual spatial barcode length.</li> <li><code>--len-umi</code> : The length of the UMI sequence (randomer) to be copied from Read 2 (beginning) to Read 1 (after spatial barcode). The default is 9.</li> <li><code>--len-r2</code> : The length of Read 2 sequences to be trimmed. The default is 101.</li> <li><code>--skip-sbcd</code> : The number of bases to be skipped in the beginning of the read. This is useful when insufficient bases are sequenced in the 1<sup>st</sup>-seq spatial barcode, which is reverse complemented. The default is 1.</li> </ul>"},{"location":"tools/reformat_fastqs/#expected-output","title":"Expected Output","text":"<ul> <li><code>[out1]</code> is output FASTQ file for Read 1. It should contain spatial barcodes, followed by the UMI (randomer) sequences.</li> <li><code>[out2]</code> is output FASTQ file for Read 2. It should contain the cDNA sequences, which includes the randomer sequence, trimmed to the specified length.</li> </ul>"},{"location":"tools/reformat_fastqs/#full-usage","title":"Full Usage","text":"<p>The full usage of <code>spatula reformat-fastqs</code> can be viewed with the <code>--help</code> option:</p> <pre><code>$ ./spatula reformat-fastqs --help\n[./spatula reformat-fastqs] -- Reformat FASTQs to be ready for STARsolo alignment\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --fq1       [STR: ]             : FASTQ file for read 1\n   --fq2       [STR: ]             : FASTQ file for read 2\n\n== Filtering options ==\n   --match-tsv [V_STR: ]           : .matched.tsv.gz file(s) to filter FASTQ file based on spatial barcodes\n   --len-match [INT: 27]           : Length of perfect match required with 2nd-seq FASTQ (27 or less)\n\n== Output Options ==\n   --out1      [STR: ]             : Output FASTQ file for read1\n   --out2      [STR: ]             : Output FASTQ file for read2\n   --skip-sbcd [INT: 0]            : Skip first bases of spatial barcode (Read 1)\n   --len-sbcd  [INT: 30]           : Length of spatial barcode (Read 1)\n   --len-umi   [INT: 9]            : Length of UMI or randomer (Read 2)\n   --len-r2    [INT: 101]          : Length of Read 2 to trim (including randomers)\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"},{"location":"tools/subset_sge/","title":"spatula subset-sge","text":""},{"location":"tools/subset_sge/#summary","title":"Summary","text":"<p><code>spatula subset-sge</code> creates a subset of spatial gene expression (SGE) matrix based on the boundary of coordinates specified by the input arguments, or input geojson file.</p> <p>Here is a summary of a typical use case:</p> <ul> <li>Input: Takes spatial gene expression (SGE) matrix created by <code>dge2sge</code>, and the boundary of coordinates specified by the input arguments, or input geojson file.</li> <li>Output: Produces a subset of the SGE matrix based on the specified spatial boundary. </li> </ul> <p>A typical use case is as follows:</p> <pre><code>spatula subset-sge --sge  /path/to/input/sge/dir/ \\\n                   --out  /path/to/output/sge/dir/ \\\n                   --json /path/to/geojson/file.geojson\n</code></pre> <p>See below for a more detailed usage description.</p>"},{"location":"tools/subset_sge/#required-options","title":"Required options","text":"<ul> <li><code>--sge</code> : The path to the input SGE directory that contains <code>barcodes.tsv.gz</code>, <code>feature.tsv.gz</code>, and <code>matrix.mtx.gz</code> file generated by <code>dge2sge</code>.</li> <li><code>--out</code> : The path to the output SGE directory that contains a subset of the original SGE files.See Expected Output for more details.</li> <li>In addition, either <code>--json</code> or <code>--xmin</code>/<code>--xmax</code>/<code>--ymin</code>/<code>--ymax</code> are expected. (See Additional Options for more details)</li> </ul>"},{"location":"tools/subset_sge/#additional-options","title":"Additional Options","text":""},{"location":"tools/subset_sge/#options-related-to-the-boundary-file-in-geojson-format","title":"Options Related to the Boundary file in geojson Format.","text":"<ul> <li><code>--json</code> : The path to the input geojson file that contains the boundary of the spatial coordinates. Note that the unit of geojson file is micron (um), and the scale has to be matched by <code>--px-per-um</code> parameter. The boundary is defined by the <code>geometry</code> field in the geojson file. The boundary is expected to be a set of polygons, and the coordinates are expected to be in the same coordinate system as the spatial coordinates in the SGE matrix.</li> <li><code>--json-x-offset</code> : The x-coordinate offset to be added to the boundary defined in the geojson file. This is useful when the boundary is defined in a shifted coordinate system from the spatial coordinates in the SGE matrix.</li> <li><code>--json-y-offset</code> : The y-coordinate offset to be added to the boundary defined in the geojson file. This is useful when the boundary is defined in a shifted coordinate system from the spatial coordinates in the SGE matrix.</li> <li><code>--px-per-um</code> : Number of pixel units in the SGE matrix per micron (um). This is used to convert the boundary defined in the geojson file to the coordinate system of the SGE matrix.</li> </ul>"},{"location":"tools/subset_sge/#other-options","title":"Other Options","text":"<ul> <li><code>--xmin</code> : The minimum value of the x coordinate to crop the SGE matrix.</li> <li><code>--xmax</code> : The maximum value of the x coordinate to crop the SGE matrix.</li> <li><code>--ymin</code> : The minimum value of the y coordinate to crop the SGE matrix.</li> <li><code>--ymax</code> : The maximum value of the y coordinate to crop the SGE matrix.</li> <li><code>--out-minmax-fixed</code> : Do not update the range of x/y coordinates of the subset SGE matrix. By default, the <code>barcodes.minmax.tsv</code> file will be generated based on the coordinates of the cropped SGE matrix. With this option turned on, the <code>barcodes.minmax.tsv</code> will be identical to the original SGE matrix.</li> <li><code>--whitelist</code> : The whitelist barcodes to be subsetted to. This is useful when external softwares are used to precisely select the barcodes to be subsetted to. The whitelist file is expected to be a tsv file with the barcode sequences in the first column.</li> <li><code>--bcd</code> : The name of the barcode file in the SGE matrix. By default, it is <code>barcodes.tsv.gz</code>.</li> <li><code>--ftr</code> : The name of the feature file in the SGE matrix. By default, it is <code>features.tsv.gz</code>.</li> <li><code>--mtx</code> : The name of the matrix file in the SGE matrix. By default, it is <code>matrix.mtx.gz</code>.</li> <li><code>--minmax</code> : The name of tsv file specifying the rectangular boundary of the SGE matrix. By default, it is <code>barcodes.minmax.tsv</code>.</li> </ul>"},{"location":"tools/subset_sge/#expected-output","title":"Expected Output","text":"<p>In the output directory <code>[outdir]</code>, the following files will be created.</p> <ul> <li><code>[outdir]/barcodes.tsv.gz</code> contains the list of barcodes in the subsetted SGE matrix. Each line contains the following information:<ol> <li>Barcode sequence</li> <li>Increasing index of the barcode (1-based), which is not necessarily contiguous.</li> <li>Sequential and contiguous index of the barcode (1-based). This should match to the integer IDs of barcodes in the <code>matrix.mtx.gz</code> file.</li> <li>Lane of spatial coordinate</li> <li>Tile of spatial coordinate</li> <li>X-coordinate of spatial coordinate</li> <li>Y-coordinate of spatial coordinate</li> <li>Comma-separated counts of observations in each <code>matrix.mtx.gz</code> file. The order of the counts should match the order of <code>--mtx</code> options.</li> </ol> </li> <li><code>[outdir]/features.tsv.gz</code> contains the list of genes in the subsetted SGE matrix. Each line contains the following information:<ol> <li>Gene ID (unique identifier)</li> <li>Gene name</li> <li>Sequential and contiguous index of the gene (1-based). This should match to the integer IDs of genes in the <code>matrix.mtx.gz</code> file.</li> <li>Comma-separated counts of observations in each <code>matrix.mtx.gz</code> file. The order of the counts should match the order of <code>--mtx</code> options.</li> </ol> </li> <li><code>[outdir]/matrix.mtx.gz</code> contains the subsetted spatial expression matrix in SGE format. After three header lines following the Market Exchange format, the matrix file contains the following information, separated by spaces.<ol> <li>barcode index (1-based)</li> <li>gene index (1-based)</li> <li>(multiple space-separated entries) counts of observations, in the order of input files in <code>--mtx</code> options.</li> </ol> </li> <li><code>barcodes.minmax.tsv</code> file contains four columns - <code>xmin</code>, <code>xmax</code>, <code>ymin</code>, and <code>ymax</code> or the spatial coordinates of subsetted SGE matrix.</li> </ul>"},{"location":"tools/subset_sge/#full-usage","title":"Full Usage","text":"<p>The full usage of <code>spatula subset-sge</code> can be viewed with the <code>--help</code> option:</p> <pre><code>$ ./spatula subset-sge --help\n[./spatula subset-sge] -- Subset Spatial SGE based on bounding box\n\n Copyright (c) 2022-2024 by Hyun Min Kang\n Licensed under the Apache License v2.0 http://www.apache.org/licenses/\n\nDetailed instructions of parameters are available. Ones with \"[]\" are in effect:\n\nAvailable Options:\n\n== Input options ==\n   --sge              [STR: ]             : Spatial gene expression directory\n   --bcd              [STR: barcodes.tsv.gz] : Barcode file path (e.g. barcodes.tsv.gz)\n   --ftr              [STR: features.tsv.gz] : Feature file path (e.g. feature.tsv.gz)\n   --mtx              [STR: matrix.mtx.gz] : Matrix file path (e.g. matrix.mtx.gz)\n   --minmax           [STR: barcodes.minmax.tsv] : Boundary file path (e.g. barcodes.minmax.tsv)\n\n== Filter options ==\n   --xmin             [INT: 0]            : Minimum x coordinate\n   --xmax             [INT: 2147483647]   : Maximum x coordinate\n   --ymin             [INT: 0]            : Minimum y coordinate\n   --ymax             [INT: 2147483647]   : Maximum y coordinate\n   --out-minmax-fixed [FLG: OFF]          : Do not update output minmax coordinates based on the observed points\n   --json             [STR: ]             : Geojson file containing multiple polygons\n   --json-x-offset    [FLT: 0.00]         : X-offset to add to the geojson boundary\n   --json-y-offset    [FLT: 0.00]         : Y-offset to add to the geojson boundary\n   --whitelist        [STR: ]             : Barcode whitelist file path\n   --px-per-um        [FLT: 1000.00]      : Pixels/um scale (default: 1000, 26.67 for HiSeq2500, 28.75 for NovaSeq 6000)\n\n== Output Options ==\n   --out              [STR: ]             : Output directory\n\n\nNOTES:\nWhen --help was included in the argument. The program prints the help message but do not actually run\n</code></pre>"}]}